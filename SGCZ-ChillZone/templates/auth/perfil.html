{% extends 'layouts/adminlte_base.html' %}
{% set title = 'Mi Perfil' %}
{% block page_header %}
<div class="row mb-2">
  <div class="col-sm-6"><h1 class="m-0">Mi Perfil</h1></div>
  <div class="col-sm-6"><ol class="breadcrumb float-sm-right"><li class="breadcrumb-item"><a href="{{ url_for('index') }}">Inicio</a></li><li class="breadcrumb-item active">Perfil</li></ol></div>
</div>
{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-4">
    <!-- Profile Image -->
    <div class="card card-primary card-outline">
      <div class="card-body box-profile">
        <div class="text-center">
          {% if user.imagen_url %}
            <img class="profile-user-img img-fluid img-circle" src="{{ user.imagen_url }}" alt="User profile picture" style="width: 100px; height: 100px; object-fit: cover;">
          {% else %}
            <img class="profile-user-img img-fluid img-circle" src="https://ui-avatars.com/api/?name={{ user.nombre }}+{{ user.apellido }}&background=random&color=fff&size=128" alt="User profile picture">
          {% endif %}
        </div>
        <h3 class="profile-username text-center">{{ user.nombre }} {{ user.apellido }}</h3>
        <p class="text-muted text-center">{{ user.rol }}</p>
        <ul class="list-group list-group-unbordered mb-3">
          <li class="list-group-item">
            <b>Correo</b> <a class="float-right">{{ user.correo }}</a>
          </li>
          {% if user.rol == 'ADMIN' %}
          <li class="list-group-item">
            <b>Estado</b> <a class="float-right">{{ user.estado }}</a>
          </li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
  
  <div class="col-md-8">
    <div class="card">
      <div class="card-header p-2">
        <ul class="nav nav-pills">
          <li class="nav-item"><a class="nav-link active" href="#settings" data-toggle="tab">Configuración</a></li>
        </ul>
      </div>
      <div class="card-body">
        <div class="tab-content">
          <div class="active tab-pane" id="settings">
            <form class="form-horizontal" method="post" enctype="multipart/form-data" onsubmit="return confirmAction(event, this, '¿Guardar cambios?', 'Se actualizará tu información de perfil.', 'Sí, guardar')">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              
              <div class="form-group row">
                <label for="inputName" class="col-sm-3 col-form-label">Cambiar Foto</label>
                <div class="col-sm-9">
                  <div class="custom-file">
                    <input type="file" class="custom-file-input" id="customFile" name="imagen" accept="image/*">
                    <label class="custom-file-label" for="customFile">Elegir archivo</label>
                  </div>
                </div>
              </div>
              
              <div class="form-group row">
                <label for="inputEmail" class="col-sm-3 col-form-label">Nueva Contraseña</label>
                <div class="col-sm-9">
                  <div class="input-group">
                    <input type="password" class="form-control" id="inputEmail" name="password" placeholder="Dejar en blanco para mantener la actual">
                    <div class="input-group-append">
                      <span class="input-group-text" onclick="togglePassword('inputEmail', this)" style="cursor: pointer;">
                        <i class="fas fa-eye"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="form-group row">
                <label for="inputName2" class="col-sm-3 col-form-label">Confirmar Contraseña</label>
                <div class="col-sm-9">
                  <div class="input-group">
                    <input type="password" class="form-control" id="inputName2" name="confirm_password" placeholder="Confirmar nueva contraseña">
                    <div class="input-group-append">
                      <span class="input-group-text" onclick="togglePassword('inputName2', this)" style="cursor: pointer;">
                        <i class="fas fa-eye"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="form-group row">
                <div class="offset-sm-3 col-sm-9">
                  <button type="submit" class="btn btn-danger">Guardar Cambios</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>
<script>
$(function () {
  bsCustomFileInput.init();
});

function togglePassword(inputId, iconSpan) {
  const input = document.getElementById(inputId);
  const icon = iconSpan.querySelector('i');
  if (input.type === "password") {
    input.type = "text";
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    input.type = "password";
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}
</script>
{% endblock %}
