{% extends 'layouts/adminlte_base.html' %}
{% set title = 'Historial de Reservas' %}
{% block page_header %}
<div class="row mb-2">
  <div class="col-sm-6"><h1 class="m-0">Historial de Reservas</h1></div>
  <div class="col-sm-6"><ol class="breadcrumb float-sm-right"><li class="breadcrumb-item"><a href="{{ url_for('index') }}">Inicio</a></li><li class="breadcrumb-item"><a href="{{ url_for('reportes.index') }}">Reportes</a></li><li class="breadcrumb-item active">Reservas</li></ol></div>
</div>
{% endblock %}
{% block content %}
<form method="get" class="card card-body mb-3">
  <div class="form-row">
    <div class="col-md-3">
      <label>Fecha inicio</label>
      <input type="date" class="form-control" name="fecha_ini" value="{{ fecha_ini or '' }}" />
    </div>
    <div class="col-md-3">
      <label>Fecha fin</label>
      <input type="date" class="form-control" name="fecha_fin" value="{{ fecha_fin or '' }}" />
    </div>
    <div class="col-md-3">
      <label>Estado</label>
      <select class="form-control" name="estado">
        <option value="">Todos</option>
        <option value="FINALIZADA" {% if estado == 'FINALIZADA' %}selected{% endif %}>Completada</option>
        <option value="CANCELADA" {% if estado == 'CANCELADA' %}selected{% endif %}>Cancelada</option>
        <option value="PENDIENTE" {% if estado == 'PENDIENTE' %}selected{% endif %}>Pendiente</option>
        <option value="ACTIVA" {% if estado == 'ACTIVA' %}selected{% endif %}>En curso</option>
      </select>
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button class="btn btn-primary mr-2">Filtrar</button>
      <a href="{{ url_for('reportes.reservas_hist') }}" class="btn btn-outline-secondary">Limpiar</a>
    </div>
  </div>
</form>
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="card-title mb-0">Resultados ({{ reservas|length }})</h3>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead class="thead-light">
          <tr>
            <th>Fecha</th>
            <th>Inicio</th>
            <th>Fin</th>
            <th>Usuario</th>
            <th>Recurso</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
        {% for r in reservas %}
          <tr>
            <td>{{ r.fecha }}</td>
            <td>{{ r.hora_inicio }}</td>
            <td>{{ r.hora_fin }}</td>
            <td>{{ r.usuario }}</td>
            <td>{{ r.recurso }}</td>
            <td>
              {% if 'CANCELADA' in r.estado %}
                <span class="badge badge-danger">Cancelada</span>
              {% elif r.estado == 'FINALIZADA' %}
                <span class="badge badge-success">Completada</span>
              {% elif r.estado == 'ACTIVA' %}
                <span class="badge badge-primary">En curso</span>
              {% elif r.estado == 'PENDIENTE' %}
                <span class="badge badge-warning">Pendiente</span>
              {% else %}
                <span class="badge badge-secondary">{{ r.estado|title }}</span>
              {% endif %}
            </td>
          </tr>
        {% else %}
          <tr><td colspan="6" class="text-center text-muted">Sin reservas</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
